<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Pacote para consultas nos portais Federais e Estaduais do Brasil</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Zservices</h1>
        <p>Serviços de pesquisas nos portais federais e estaduais do Brasil.</p>
        <p class="view"><a href="https://github.com/juniorb2ss/zServices">View the Project on GitHub <small>juniorb2ss/zServices</small></a></p>
        <ul>
          <li><a href="https://github.com/juniorb2ss/zServices/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/juniorb2ss/zServices/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/juniorb2ss/zServices">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="zservices" class="anchor" href="#zservices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>zServices</h1>

<p><a href="https://laravel.com"><img src="https://img.shields.io/badge/Laravel-5-green.svg" alt="Laravel 5"></a>
<a href="https://packagist.org/packages/zservices/query"><img src="https://poser.pugx.org/zservices/query/v/stable" alt="Latest Stable Version"></a> <a href="https://packagist.org/packages/zservices/query"><img src="https://poser.pugx.org/zservices/query/downloads" alt="Total Downloads"></a> <a href="https://packagist.org/packages/zservices/query"><img src="https://poser.pugx.org/zservices/query/v/unstable" alt="Latest Unstable Version"></a> <a href="https://packagist.org/packages/zservices/query"><img src="https://poser.pugx.org/zservices/query/license" alt="License"></a>
<a href="https://travis-ci.org/juniorb2ss/zServices"><img src="https://api.travis-ci.org/juniorb2ss/zServices.svg?branch=master" alt="Build Status"></a>
<a href="https://gemnasium.com/github.com/juniorb2ss/zServices"><img src="https://gemnasium.com/badges/github.com/juniorb2ss/zServices.svg" alt="Dependency Status"></a>
<a href="https://github.com/juniorb2ss/zServices/issues"><img src="https://img.shields.io/github/issues/juniorb2ss/zServices.svg" alt="Issues Status"></a>
<a href="https://github.com/juniorb2ss/zServices/stargazers"><img src="https://img.shields.io/github/stars/juniorb2ss/zServices.svg" alt="Stars Status"></a>
<a href="https://codeclimate.com/github/juniorb2ss/zServices"><img src="https://codeclimate.com/github/juniorb2ss/zServices/badges/gpa.svg" alt="Code Climate"></a>
<a href="https://codeclimate.com/github/juniorb2ss/zServices"><img src="https://codeclimate.com/github/juniorb2ss/zServices/badges/issue_count.svg" alt="Issue Count"></a>
<a href="https://codeclimate.com/github/juniorb2ss/zServices/coverage"><img src="https://codeclimate.com/github/juniorb2ss/zServices/badges/coverage.svg" alt="Test Coverage"></a>
<a href="https://scrutinizer-ci.com/g/juniorb2ss/zServices/?branch=master"><img src="https://scrutinizer-ci.com/g/juniorb2ss/zServices/badges/quality-score.png?b=master" alt="Scrutinizer Code Quality"></a></p>

<p>Pacote para buscar informações nos serviços federais e estaduais do Brasil</p>

<p>É feito uma requisição no serviço, retornando <code>cookie</code> e <code>captcha</code> do serviço. Após usuário informar
o captcha é feito outra requisição, retornando informações do CNPJ.</p>

<p>Este pacote deverá ser usado com responsabilidade, o autor e contribuidores não devem responder pelas implementações/ações feita com este pacote.</p>

<h3>
<a id="atenção" class="anchor" href="#aten%C3%A7%C3%A3o" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Atenção</h3>

<p>Este pacote foi desenvolvido com o intuito de facilidade consultas através de ERP ou serviços que necessitam de consistência de dados. Não foi criado com o intuito de ser utilizado como <code>bot</code></p>

<p>Toda implementação será de sua responsabilidade.</p>

<h3>
<a id="version-stable" class="anchor" href="#version-stable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Version Stable</h3>

<p>1.0.7</p>

<h3>
<a id="instalação" class="anchor" href="#instala%C3%A7%C3%A3o" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalação</h3>

<div class="highlight highlight-source-shell"><pre>$ composer require zservices/query 1.<span class="pl-k">*</span></pre></div>

<h3>
<a id="laravel-5" class="anchor" href="#laravel-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Laravel 5</h3>

<p>Configure os providers e aliases em <code>config/app.php</code></p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>providers<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">    <span class="pl-c">// ....</span></span>
<span class="pl-s1">      <span class="pl-c1">zServices\Laravel\</span><span class="pl-c1">ServicesProvider</span><span class="pl-k">::</span><span class="pl-c1">class</span>,</span>
<span class="pl-s1">    <span class="pl-c">//...</span></span>
<span class="pl-s1">];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-s"><span class="pl-pds">'</span>aliases<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">    <span class="pl-c">//...</span></span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>Sintegra<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">zServices\Laravel\</span><span class="pl-c1">SintegraFacade</span><span class="pl-k">::</span><span class="pl-c1">class</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>ReceitaFederal<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">zServices\Laravel\</span><span class="pl-c1">ReceitaFederalFacade</span><span class="pl-k">::</span><span class="pl-c1">class</span>,</span>
<span class="pl-s1">    <span class="pl-c">//...</span></span>
<span class="pl-s1">];</span></pre></div>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">ReceitaFederal</span>;</span>
<span class="pl-s1"><span class="pl-smi">$service</span> <span class="pl-k">=</span> <span class="pl-c1">ReceitaFederal</span><span class="pl-k">::</span>service()<span class="pl-k">-&gt;</span>request();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">return</span> view(<span class="pl-s"><span class="pl-pds">'</span>receitafederal.query.example<span class="pl-pds">'</span></span>,[</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>cookie<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$service</span><span class="pl-k">-&gt;</span>cookie(),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>image<span class="pl-pds">'</span></span>  <span class="pl-k">=&gt;</span> <span class="pl-smi">$service</span><span class="pl-k">-&gt;</span>captcha()</span>
<span class="pl-s1">]);</span></pre></div>

<h3>
<a id="exemplos" class="anchor" href="#exemplos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exemplos</h3>

<h4>
<a id="receita-federal" class="anchor" href="#receita-federal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Receita Federal</h4>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">zServices\ReceitaFederal\Search</span> <span class="pl-k">as</span> <span class="pl-c1">ReceitaFederal</span>;</span>
<span class="pl-s1"><span class="pl-smi">$search</span> <span class="pl-k">=</span> (<span class="pl-k">new</span> <span class="pl-c1">ReceitaFederal</span>)<span class="pl-k">-&gt;</span>service()<span class="pl-k">-&gt;</span>request(); <span class="pl-c">// initialize</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$captchaBase64Image</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>captcha(); <span class="pl-c">// captura base64_decode da imagem</span></span>
<span class="pl-s1"><span class="pl-smi">$cookieRequest</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>cookie(); <span class="pl-c">// captura o cookie do request iniciado</span></span>
<span class="pl-s1"></span></pre></div>

<p>Dados após o form</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// Requisitar dados</span></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">zServices\ReceitaFederal\Search</span> <span class="pl-k">as</span> <span class="pl-c1">ReceitaFederal</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$search</span> <span class="pl-k">=</span> (<span class="pl-k">new</span> <span class="pl-c1">ReceitaFederal</span>)<span class="pl-k">-&gt;</span>service();</span>
<span class="pl-s1"><span class="pl-smi">$crawler</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>data(<span class="pl-smi">$cnpj</span>, <span class="pl-smi">$cookie</span>, <span class="pl-smi">$captcha</span>, []);</span>
<span class="pl-s1"><span class="pl-smi">$arrayData</span> <span class="pl-k">=</span> <span class="pl-smi">$crawler</span><span class="pl-k">-&gt;</span>scraping(); <span class="pl-c">// array com as informações da entidade</span></span></pre></div>

<p>Para consultar receita federal basta pegar o cookie e a imagem do captcha, após resolver o captcha é preciso
retornar o cookie e a string resolvida para o serviço, ele deverá retornar um array associado com as informações
do CNPJ informado.</p>

<h4>
<a id="sintegra-sp" class="anchor" href="#sintegra-sp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sintegra SP</h4>

<p>Dados para form</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">zServices\Sintegra\Search</span> <span class="pl-k">as</span> <span class="pl-c1">Sintegra</span>;</span>
<span class="pl-s1"><span class="pl-smi">$search</span> <span class="pl-k">=</span> (<span class="pl-k">new</span> <span class="pl-c1">Sintegra</span>)<span class="pl-k">-&gt;</span>service(<span class="pl-s"><span class="pl-pds">'</span>SP<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>request(); <span class="pl-c">// initialize</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$captchaBase64Image</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>captcha(); <span class="pl-c">// captura base64_decode da imagem</span></span>
<span class="pl-s1"><span class="pl-smi">$cookieRequest</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>cookie(); <span class="pl-c">// captura o cookie do request iniciado</span></span>
<span class="pl-s1"><span class="pl-smi">$params</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>params(); <span class="pl-c">// captura o valor dos inputs</span></span>
<span class="pl-s1"><span class="pl-smi">$paramBot</span> <span class="pl-k">=</span> <span class="pl-smi">$params</span>[<span class="pl-s"><span class="pl-pds">'</span>parambot<span class="pl-pds">'</span></span>]; <span class="pl-c">// captura parambot</span></span>
<span class="pl-s1"></span></pre></div>

<p>Dados após o form</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// Requisitar dados</span></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">zServices\Sintegra\Search</span> <span class="pl-k">as</span> <span class="pl-c1">Sintegra</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$search</span> <span class="pl-k">=</span> (<span class="pl-k">new</span> <span class="pl-c1">Sintegra</span>)<span class="pl-k">-&gt;</span>service(<span class="pl-s"><span class="pl-pds">'</span>SP<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$crawler</span> <span class="pl-k">=</span> <span class="pl-smi">$search</span><span class="pl-k">-&gt;</span>data(<span class="pl-smi">$cnpj</span>, <span class="pl-smi">$cookie</span>, <span class="pl-smi">$captcha</span>, <span class="pl-smi">$paramBot</span>);</span>
<span class="pl-s1"><span class="pl-smi">$arrayData</span> <span class="pl-k">=</span> <span class="pl-smi">$crawler</span><span class="pl-k">-&gt;</span>scraping(); <span class="pl-c">// array com as informações da entidade</span></span>
<span class="pl-s1"></span></pre></div>

<p>O portal do sintega de SP além do captcha possui um valor no formulário com nome de <code>paramBot</code>. Este valor é único por requisição, não por cookie. Então para que a requisição funcione corretamente é preciso pegar e devolver ele nas requisições posteriores.</p>

<p>O método <code>$search-&gt;params()</code> devolve um array com os inputs que são necessários devolver, que no caso do sintegra de sp é apenas <code>paramBot</code>. Este valor deverá ser inserido em seu formulário e devolvido como array associado na requisição das informações da entidade.</p>

<h3>
<a id="retornos" class="anchor" href="#retornos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retornos</h3>

<p>Imagem de exemplo com as informações de retorno do serviço.</p>

<h4>
<a id="receita-federal-1" class="anchor" href="#receita-federal-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Receita Federal</h4>

<p><img src="https://camo.githubusercontent.com/50a04fb56500e16b07deb7afceeccb16bfc3809a/687474703a2f2f7333322e706f7374696d672e6f72672f7236306775726467352f53637265656e73686f745f66726f6d5f323031365f30345f32385f31385f34335f31332e706e67" alt="Retorno"></p>

<h4>
<a id="sintegra-sp-1" class="anchor" href="#sintegra-sp-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sintegra SP</h4>

<p><img src="https://uploaddeimagens.com.br/images/000/612/350/original/Screenshot_from_2016-05-01_16-51-52.png?1462132324" alt="Retorno"></p>

<h3>
<a id="desenvolvimento" class="anchor" href="#desenvolvimento" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Desenvolvimento</h3>

<p>Deseja contribuir com desenvolvimento? pull request :)</p>

<h3>
<a id="to-do" class="anchor" href="#to-do" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>To-do</h3>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>MIT</p>

<p><strong>Free Software, Hell Yeah!</strong></p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/juniorb2ss">juniorb2ss</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
